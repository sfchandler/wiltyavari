function getEmailList(){$.ajax({type:"GET",url:"./mailList.php",dataType:"html",success:function(a){$(".mailListBody").html(""),$(".mailListBody").html(a),$(".numRows").html($("#rCount").val())},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}}).done(function(){$(".messageid").on("click",function(a){getMailView($(this)),getAttachments($(this))})})}function getAttachments(a){var d,b=a.closest("tr"),c=b.find(".messageid").data("messageid");$.ajax({type:"POST",url:"./getAttachments.php",data:{messageid:c},dataType:"json",success:function(a){$(".mailAttachments").html(""),$.each(a,function(a,b){"pdf"==b.filetype?d="pdf-adobe-portable-document-format.ico":"docx"==b.filetype?d="docx-microsoft-word-open-xml-document.png":"doc"==b.filetype?d="doc-microsoft-word-97-to-2003-document.png":"txt"==b.filetype&&(d="text_document.ico"),$(".mailAttachments").append('<img src="./filetypes/'+d+'" /><a href="'+b.filepath+'" target="_blank">'+b.filename+"</a><br>")})},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}})}function getMailView(a){var d,b=a.closest("tr"),c=b.find(".messageid").data("messageid");$.ajax({type:"POST",url:"./mailView.php",data:{messageid:c},dataType:"json",success:function(a){$.each(a,function(a,b){$(".mailSubject").html(),$(".mailSubject").html(b.subject),$(".mailFrom").html(),$(".mailFrom").html(b.mailfrom),$(".sentDate").html(),$(".sentDate").html(b.date),$(".mailTo").html(),$(".mailTo").html(b.mailto),$(".mailAttachments").html(),$(".mailAttachments").html(),$(".mailBody").html(""),d=b.msgbody,d.replace(/(\r\n|\n|\r)/gm,"")})},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}}).done(function(){$(".mailBody").html("");var a=$("<textarea/>").html(d).text();$(".mailBody").contents().find("html").html(a.replace(/\\n/g,"").replace(/\\r/g,"")),$(".mailBody").contents().find("a").click(function(a){a.preventDefault()})})}function filterData(a){return a=a.replace(/<?\/body[^>]*>/g,""),a=a.replace(/[\r|\n]+/g,""),a=a.replace(/<--[\S\s]*?-->/g,""),a=a.replace(/<noscript[^>]*>[\S\s]*?<\/noscript>/g,""),a=a.replace(/<script[^>]*>[\S\s]*?<\/script>/g,""),a=a.replace(/<script.*\/>/,"")}function htmlEntities(a){return String(a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function convertToHTMLVisibleNewline(a){return null!=a&&""!=a?a.replace(/\n/g,"<br/>"):a}function convertToTextVisibleNewLine(a){return null!=a&&""!=a?a.replace(/\<br\>/g,"\n"):a}function escapeNewLineChars(a){return null!=a&&""!=a?a.replace(/\n/g,"\\n"):a}$(function(){function a(){window.history.forward()}window.history.forward(),window.onload=a(),window.onpageshow=function(b){b.persisted&&a()},$(document).bind("keypress",function(a){13==a.keyCode&&(a.preventDefault(),$("#searchBtn").trigger("click"))}),$(document).on("click",".inbox-load",function(a){$("#tblMailView").show(),$(".formDisplay").html("")}),$(document).on("click",".checkBtn",function(a){var b=$(this).closest("tr"),c=b.find(".messageid").data("messageid");window.open("./candidateReview.php?messageid="+c,"_blank")}),$(document).on("click",".diaryNotesBtn",function(a){var b=$(this).closest("tr"),c=b.find(".messageid").data("messageid");window.open("./diaryNotes.php?messageid="+c,"_blank")}),"25%"==$("#pm").val()?$("#matchPercentage").attr("class","red-percentage"):"50%"==$("#pm").val()?$("#matchPercentage").attr("class","orange-percentage"):"75%"==$("#pm").val()?$("#matchPercentage").attr("class","yellow-percentage"):"100%"==$("#pm").val()&&$("#matchPercentage").attr("class","green-percentage"),$(document).on("click",".callBtn",function(a){var b=$(this).closest("tr"),c=b.find(".messageid").data("messageid");$.ajax({type:"POST",url:"./questionare.php",data:{messageid:c},dataType:"html",success:function(a){$("#tblMailView").hide(),$(".formDisplay").html(""),$(".formDisplay").html(a),$(".screenDate").datetimepicker({dateFormat:"dd-mm-yy"}),$(".screenDate").datetimepicker("setDate",new Date),$(".intvwTime").datetimepicker({dateFormat:"dd-mm-yy",timeFormat:"hh:mm tt z"}),$("#convictionDescription").hide(),$("#medicalConditionDesc").hide(),$("#consultantId").hide(),$("#intvwTime").hide()},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}}).done(function(){$(".messageid").on("click",function(a){$("#tblMailView").show(),$(".formDisplay").html("")})})}),$(document).on("click",".screenDate",function(){$(".screenDate").datetimepicker({dateFormat:"dd-mm-yy"})}),$(document).on("click",".intvwTime",function(){$(".intvwTime").datetimepicker({dateFormat:"dd-mm-yy",timeFormat:"hh:mm tt z"})}),$(document).on("click","#medicalCondition",function(){"Yes"==$("input[name=medicalCondition]:checked","#screenFrm").val()?$("#medicalConditionDesc").show():$("#medicalConditionDesc").hide()}),$(document).on("click","#criminalConviction",function(){"Yes"==$("input[name=criminalConviction]:checked","#screenFrm").val()?$("#convictionDescription").show():$("#convictionDescription").hide()}),$(document).on("click","#bookInterview",function(){"Yes"==$("input[name=bookInterview]:checked","#screenFrm").val()?($("#consultantId").show(),$("#intvwTime").show()):"No"==$("input[name=bookInterview]:checked","#screenFrm").val()&&($("#consultantId").hide(),$("#intvwTime").hide())}),$(document).on("click",".messageid",function(a){getMailView($(this)),getAttachments($(this))}),$(document).on("click",".screenSubmit",function(a){$("#screenFrm").validate({rules:{firstName:{required:!0},lastName:{required:!0},candidateEmail:{required:!0},candidateMobile:{required:!0},convictionDescription:{required:function(a){return"Yes"==$("input:radio[name='criminalConviction']:checked").val()}},candidateSex:{required:!0},currentWrk:{required:!0},howfar:{required:!0},residentStatus:{required:!0},shiftAvailable:{required:!0}},messages:{firstName:{required:"Please enter candidate first name"},lastName:{required:"Please enter candidate last name"},candidateEmail:{required:"Please enter candidate email"},convictionDescription:{required:"Please Describe Criminal Conviction"},candidateSex:{required:"Please select candidate sex"},candidateMobile:{required:"Please enter candidate mobile"},currentWrk:{required:"Please enter work status"},howfar:{required:"Please enter how far are you willing to travel for work"},residentStatus:{required:"Please select residential status"},shiftAvailable:{required:"Please select shift available"}},submitHandler:function(a){var b=$("#messageid").val(),c=$("#firstName").val(),d=$("#lastName").val(),e=$("#candidateEmail").val();console.log("email"+e);var f=$("#candidateSex :selected").val(),g=$("#screenDate").val(),h=$("#candidateSuburb").val(),i=$("#candidatePhone").val(),j=$("#candidateMobile").val(),k=$("textarea#currentWrk").val(),l=$("#howfar").val(),m=$("textarea#genLabourPay").val(),n=$("input[name=criminalConviction]:checked","#screenFrm").val(),o=$("#convictionDescription").val(),p=$("input[name=medicalCondition]:checked","#screenFrm").val(),q=$("#medicalConditionDesc").val(),r=$("input[name=hasCar]:checked","#screenFrm").val(),s=$("input[name=residentStatus]:checked","#screenFrm").val(),t=[];$.each($("input[name='otherLicence']:checked"),function(){t.push($(this).val())});var u=[];$.each($("input[name='safetyGear']:checked"),function(){u.push($(this).val())});var v=[];$.each($("input[name='expOperating']:checked"),function(){v.push($(this).val())});var w=$("textarea#workType").val(),x=[];$.each($("input[name='shiftAvailable']:checked"),function(){x.push($(this).val())});var y=$("input[name=overtime]:checked","#screenFrm").val(),z=$("input[name=bookInterview]:checked","#screenFrm").val(),A=$("#intvwTime").val(),B=$("#consultantId option:selected").val();$(".screenSubmit").attr("disabled",!0),$.ajax({type:"POST",url:"./updateCandidate.php",data:{messageid:b,firstName:c,lastName:d,candidateEmail:e,candidateSex:f,screenDate:g,suburb:h,candidatePhone:i,candidateMobile:j,currentWrk:k,howfar:l,genLabourPay:m,criminalConviction:n,convictionDescription:o,medicalCondition:p,medicalConditionDesc:q,hasCar:r,residentStatus:s,otherLicence:t,safetyGear:u,expOperating:v,workType:w,shiftAvailable:x,overtime:y,bookInterview:z,intvwTime:A,consultantId:B},dataType:"json",success:function(a){console.log("DATA"+a),"SUCCESS"==a.email?(alert("email generated"),location.reload(!0)):"ERROR"==a.email?(alert("error generating email"),location.reload(!0)):"ARCHIVED"==a.status?(alert("candidate details archived"),location.reload(!0)):"EXISTS"==a.status?(alert("existing candidate updated"),location.reload(!0)):"DBERROR"==a.status?(alert("data insert error"),location.reload(!0)):""!==a.err?(alert(a.err),location.reload(!0)):(alert(a),location.reload(!0)),$(".screenSubmit").attr("disabled",!1)},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}})}})}),$(document).on("click",".searchBtn",function(a){var d=$("#searchTxt").val(),e=$("#subjectSearchTxt").val();$.ajax({type:"POST",url:"./searchMail.php",data:{searchTxt:d,subjectSearchTxt:e},dataType:"html",success:function(a){a.length>0?($(".mailListBody").html(""),$(".mailListBody").html(a),$(".numRows").html(""),$(".numRows").html($("#rowCount").val())):($(".mailListBody").html(""),$(".mailListBody").html("No Matching Results"),$(".numRows").html(""),$(".numRows").html("0"))},error:function(a,b){0===a.status?console.log("Not connect.\n Verify Network."):404==a.status?console.log("Requested page not found. [404]"):500==a.status?console.log("Internal Server Error [500]."):"parsererror"===b?console.log("Requested JSON parse failed."):"timeout"===b?console.log("Time out error."):"abort"===b?console.log("Ajax request aborted."):console.log("Uncaught Error.\n"+a.responseText)}}).done(function(){$(".messageid").on("click",function(a){$("#tblMailView").show(),$(".formDisplay").html(""),getMailView($(this)),getAttachments($(this))})})})});